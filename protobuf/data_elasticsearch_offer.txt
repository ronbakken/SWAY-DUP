

DataOffer

{
    _id
    _source {
        long sender_id
        byte sender_type
        long location_id
        boolean direct
        
        long session_id
        int session_ghost_id
        
        date created
        array date modified
        
        text title
        keyword thumbnail_key
        binary thumbnail_blurred
        
        array short deliverable_social_platforms
        (denormalized) array keyword deliverable_social_platform_keywords 
        array short deliverable_content_formats
        (denormalized) array keyword deliverable_content_format_keywords
        text deliverables_description
        
        integer reward_cash_value
        integer reward_item_or_service_value
        (denormalized) integer reward_total_value
        text reward_item_or_service_description
        
        (denormalized) short primary_categories
        
        text location_name
        text location_text
        geo_point location
        
        text description
        array string cover_keys
        array binary covers_blurred
        
        array short categories
        (denormalized) array keyword category_keywords
        (denormalized) array short categories_expanded
        (denormalized) array keyword category_keywords_expanded (including parent categories)
        
        short state
        short state_reason
        boolean archived
        (denormalized) boolean published (!direct && !archived && state == open)
        
        (denormalized) array integer proposal_counters
        
        (denormalized) array long s2cell_ids
        (denormalized) array long geohash_ints
        (denormalized) array string geohashes
        
        (denormalized) array short s2cell_id_shards
        (denormalized) array short geohash_int_shards
        (denormalized) array short geohash_shards
        
        (ai) array keyword image_keywords (keywords pulled from images)
        
    }
}

PUT offers
{
  "settings": {
    "index": {
      "number_of_shards": 17
    }
  },
  "mappings": {
    "_doc": {
      "properties": {
        "sender_id": {
          "type":  "long"
        },
        "sender_type": {
          "type":  "byte"
        },
        "location_id": {
          "type":  "long"
        },
        "direct": {
          "type":  "boolean"
        },
        
        "session_id": {
          "type":  "long"
        },
        "session_ghost_id": {
          "type":  "int"
        },
        
        "created": {
          "type":   "date",
          "format": "epoch_millis"
        },
        "modified": {
          "type":   "date",
          "format": "epoch_millis"
        },
        
        "title": {
          "type":  "text"
        },
        "thumbnail_key": {
          "type":  "keyword"
        },
        "thumbnail_blurred": {
          "type":  "binary"
        },
        
        "deliverable_social_platforms": {
          "type":  "short"
        },
        "deliverable_social_platform_keywords": {
          "type":  "keyword"
        },
        "deliverable_content_formats": {
          "type":  "short"
        },
        "deliverable_content_format_keywords": {
          "type":  "keyword"
        },
        "deliverables_description": {
          "type":  "text"
        },
        
        "reward_cash_value": {
          "type":  "integer"
        },
        "reward_item_or_service_value": {
          "type":  "integer"
        },
        "reward_total_value": {
          "type":  "integer"
        },
        "reward_item_or_service_description": {
          "type":  "text"
        },
        
        "primary_categories": {
          "type":  "short"
        },
        
        "location_name": {
          "type":  "text"
        },
        "location_text": {
          "type":  "text"
        },
        "location": {
          "type":  "geo_point"
        },
        
        "description": {
          "type":  "text"
        },
        "cover_keys": {
          "type":  "keyword"
        },
        "covers_blurred": {
          "type":  "binary"
        },
        
        "state": {
          "type":  "short"
        },
        "state_reason": {
          "type":  "short"
        },
        "archived": {
          "type":  "boolean"
        },
        "published": {
          "type":  "boolean"
        },
        
        "proposal_counters": {
          "type":  "integer"
        },
        
        "s2cell_ids": {
          "type":  "long"
        },
        "geohash_ints": {
          "type":  "long"
        },
        "geohashes": {
          "type":  "keyword"
        },
        
        "s2cell_id_shards": {
          "type":  "short"
        },
        "geohash_int_shards": {
          "type":  "short"
        },
        "geohash_shards": {
          "type":  "short"
        },
        
        "image_keywords": {
          "type":  "keyword"
        }
      }
    }
  }
}

PUT offers/_mapping/_doc
{
  "properties": {
    "sender_id": {
      "type":  "long"
    },
    "location_id": {
      "type":  "long"
    },
    "direct": {
      "type":  "boolean"
    },
  }
}

PUT offers/_doc/0
{
  "title": "Hello world",
  "description": "This is an offer!"
}

Text search query
^boosts
see https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html
see https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html
see https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html
see https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html
GET /offers/_search
{
  "query": {
    "multi_match" : {
      "query": "Will Smith",
      "type": "most_fields",
      "fields": [
        "title^4",
        "location_name^4",
        "location_text^2",
        "description^3",
        "*_description^2",
        "*_keywords^2",
        "*_expanded"
      ] 
    }
  }
}

With added filter to only show published objects
GET /offers/_search
{
  "query": {
    "bool": {
      "filter": {
        "term": {
          "published": true
        }
      },
      "must": {
        "multi_match" : { // provide separate multi_match blocks with their own ranking for different types mixed
          "query": "Will Smith",
          "type": "most_fields",
          "fields": [
            "title^4",
            "location_name^4",
            "location_text^2",
            "description^3",
            "*_description^3",
            "*_keywords^2",
            "*_expanded"
          ]
        }
      }
    }
  }
}

