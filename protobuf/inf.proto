
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

syntax = "proto3";

option csharp_namespace = "InfX";

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

message ConfigSubCategories {
  repeated string labels = 1;
}

message ConfigCategories {
  repeated ConfigSubCategories sub = 1;
}

message ConfigOAuthProvider {
  bool visible = 1;
  bool enabled = 2;
  /// Visual name
  string label = 3;
  int32 fontAwesomeBrand = 14;
  /// API endpoints of the OAuth provider
  string host = 4;
  /// API endpoints for Twitter-like OAuth
  string requestTokenUrl = 5; // If request token is not set, the alternate mechanism is used
  string authenticateUrl = 6;
  /// API endpoints for Spotify-like OAuth
  string authUrl = 7;
  string authQuery = 8;
  /// Url that will be used to detect login success by the app
  string callbackUrl = 9;
  /// Generated by the OAuth provider, not really secret, Twitter-like
  string consumerKey = 10;
  string consumerSecret = 11;
  /// From OAuth provider, Spotify-like, may not include clientSecret
  string clientId = 12;
  /// Request settings
  string native = 13;
}

message ConfigOAuthProviders {
  /// List of all OAuthProviders
  repeated ConfigOAuthProvider all = 1;
  /// This AES-256 key decrypts the OAuth keys
  string key = 2;
}

message ConfigData {
  /// If this goes up in a config, the client must be updated
  int32 clientVersion = 1;
  
  /// URLs where the config can be downloaded
  repeated string downloadUrls = 4;
  
  /// Configuration data
  ConfigCategories categories = 2;
  ConfigOAuthProviders oauthProviders = 3;
  
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

message CategoryId {
  int32 main = 1;
  int32 sub = 2;
}

message CategoryIdSet {
  repeated CategoryId ids = 1;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// Type of message
enum NetMessageType {
  UNKNOWN = 0;
  CLIENT_IDENTIFY = 1;
  
}

// TODO: proto3 has Any type, check if supported by dart protobuf compiler
/* message NetMessageHeader {
  NetMessageType type = 1;
  int32 requestSeq = 2; // This message is a request, the response will have the same identifier under the response parameter
  int32 responseSeq = 3; // This is a response, using the identifier from the request it is responding to
} */

// Generic rejection
message NetResRejected {
  string rejectReason = 1;
}

// Client requests the server permission to upload an image
// The server may delete the image later if it is never used
message NetReqImageUpload {
  // File information
  string fileName = 1;
  int32 fileSize = 2;
  
  // Hashed file contents
  string sha256 = 3;
  
}

// Request parameters to be used by the client verbatim for uploading
message NetResImageUpload {
  string requestMethod = 1;
  string requestUrl = 2;
  string headerContentType = 3;
  string headerContentLength = 4;
  string headerHost = 5;
  string headerXAmzDate = 6;
  string headerXAmzStorageClass = 7;
  string headerAuthorization = 8;
  
}

// Message to create offer
message NetReqCreateOffer {
  string title = 1;
  repeated string imageIds = 2;
  string description = 3;
  string deliverables = 4;
  string reward = 5;
  
}

// Response to successful offer creation
message NetResCreateOffer {
  // Identifier of the offer on the server
  int64 id = 1;
  
}

/* end of file */
